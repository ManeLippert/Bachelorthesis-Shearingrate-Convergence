! WARNING
! The miller test case was found to be quite sensitive to the accuracy of the numerical integrals
! To get this one to pass consistently, parallel disspation and adiabitic electrons and a smooth
! initial condition were required, as well as increasing the number of points in the numerical
! integral to 501.  More sensitive cases are likely not to be reprodicible across machines and compilers 

!---------------------------------------------------------------------------------------------------------------------
&CONTROL
 order_of_the_scheme = 'fourth_order'
 parallel_boundary_conditions = "open"
 NON_LINEAR = .false. 
 zonal_adiabatic = .false.
 METHOD = 'EXP' 
 METH   = 2 
 DTIM   = 0.01
 NTIME  = 5
 NAVERAGE = 100
 !nlapar = .true.
 !nlbpar = .false.
 collisions = .false.
 disp_par = 0.8
 disp_vp  = 0.2
 disp_x   = 0.0
 disp_y   = 0.0
 lverbose     = .false.
 normalized =.true.
 silent = .false. 
 dt_min = 0.
 io_format = 'ascii'
 io_testdata = .true.
/
!---------------------------------------------------------------------------------------------------------------------
 &GRIDSIZE                        !Namelist read in grid.f90
                                !Default grids sizes of 0 will not run, hence these must be provided.
 NX = 3,                           !Number of radial wave vectors - currently needs to be an odd number for fft
 N_s_grid = 16,                 !Number of grid points along the field line
 NPERIOD = 1,                         !Integer that specifies the length of the field line,
                                !The field line makes 2*nperiod - 1 poloidal turns. For nonlinear, nperiod must be 1. 
                                !Note that for nperiod = 1 and mode_box=true the kx modes are connected 
                                !For other nperiod /= 1 the solution is set to zero at the end of the field line.
 N_mu_grid   = 8,                 !Total number of magnetic moment grid points 
 N_vpar_grid = 16,                 !Number of grid points for parallel velocity (formerly nvpar, which still works)
 NMOD = 1,                        !Total number of binormal modes - do not interact for non-linear runs
 number_of_species = 1                 !Number of species. Note: do not count the adiabatic species 
 n_procs_mu=2
 n_procs_s=2
 n_procs_vpar=2
 n_procs_sp=1
 /
!---------------------------------------------------------------------------------------------------------------------
 &MODE                                !Namelist read in mode.f90
 CHIN    = 0.0,                         !Poloidal shift of the ballooning transform                        (default = 0)
 KTHRHO  = 0.3                       !Poloidal wave vector(s) if mode_box=.false.                        (default = 0 fails)
 mode_box = .true.,                 !Determines if there is a 2D grid of ky,kx. if true use nperiod = 1    (default = F)
 krhomax = 0.5,                        !For mode_box, the maximum k_theta rho_i (ky) used                 (default = 0 fails)
 ikxspace = 7,                         !Determines the spacing between the different kx modes                (default = 0 fails)
 /
!---------------------------------------------------------------------------------------------------------------------
 &GEOM                                 !Namelist read in geom.F90
 SHAT = 1.,                        !Magnetic shear        (not used with geom_type chease)                (default = 1.23e4)
 Q    = 2.,                         !Safety factor        (not used with geom_type chease)                (default = 1.23e4)
 EPS  = 0.16                        !minor radial coordinate / major radius                                (default = 1.23e4)
 GEOM_TYPE = 'miller'           !Switch for the metric: 's-alpha' or 'circ' or 'chease'                        (default = 's-alpha')
 SIGNB = 1,                    !Sign of B.grad_phi, the toroidal component of the magnetic field (default = 1)
 SIGNJ = -1                      !Sign of j.grad_phi, the toroidal component of the plasma current (default = 1)
 EPS_TYPE = 1                   !> Radial coordinate used to specify the chosen FS (chease only)
                                !> 1=eps, 2=rho_psi                                             (default=1)
 kappa = 1.2,                   !Elongation in Miller parametrisation model (all parameters below are only used in 
                                ! 'miller' geometry : 
                                !  R = Rmil + r*cos(theta + arcsin(delta)*sin(theta))
                                !  Z = ZZmil + r*kappa*sin(theta + zeta*sin(2*theta))
                                !with r=(Rmax-Rmin)/2
                                !Miller geometry is normalised with Rmil (Rref=Rmil, EPS=r/Rmil)
                                !Bref=Bt(R=Rmil) -> F=RBt=RrefBref 
 delta = 0.7,                  !Triangularity
 square = 0.2,                  !Squareness
 Zmil = 0.1,                    !Elevation : Zmil = ZZmil/Rmil 

 skappa = 0.4,                    !Radial derivative of kappa : (r * dkappa/dr) / kappa
 sdelta = 0.2,                    !Radial derivative of delta : (r * ddelta/dr) / sqrt(1-delta^2)
 ssquare = 0.4,                   !Radial derivative of zeta : r * dzeta/dr
 dRmil = 0.22,                   !Radial derivative of Rmil : dRmil/dr
 dZmil = 0.2,                    !Radial derivative or Zmil : dZmil/dr

 gradp_type = 'alpha_mhd'             
 gradp = 0.3,                    !Pressure gradient 
                                 ! alpha definition : eq 42 of Miller et al. PoP 5, 973 (1998)
/
!---------------------------------------------------------------------------------------------------------------------
 &SPCGENERAL                        !This namelist read in components.f90
 beta = 3e-4,                   !Plasma beta (not used if nlapar = .false.)                        (default = 0.00)
 adiabatic_electrons = .true.   !Adiabatic electrons (alternative is kinetic electrons)            (default = .false.)
                                !Note that kinetic electrons require a smaller timestep for stability
 amp_init = 1e-3                !Initial amplitude of distribution function                        (default = 1e-3)
 !finit = "hybrid"               !Perturbed distribution function is initialised                 (default = 'cosine')
                                !Allowed are "noise","cosine" (default), "gauss" or "zonal"
                                !'line' (of gaussians), 'island' 'sgauss' (velocity space)
                                !'kxzero' and 'kyzero' for an individual mode only, for fac_dtim_est=1.0
 /
!---------------------------------------------------------------------------------------------------------------------
 !The species must satify quasi-neutrality.
 !This requires you to set ratios of densities and charge appropriately
 !Note that the if number_of_species above is less than the number in the list below, later ones will not be read in
 !If number_of_species is greater than the number in the in the list below, the program will crash.
 !There are no default values for most of the parameters.
 !If there is an adiabatic species, it is the negatively charged species. 

 &SPECIES                         !This namelist read in components.f90
 MASS  = 1.0,                         !Species mass in terms of deuterium mass (=2.013 AMU)
 Z     = 1.0,                         !Species charge. If negative, assumed to be the electrons.
 TEMP  = 1.,                         !Temperature of species scaled by reference temperature - see CPC paper
 DENS  = 1.,                        !Density of species scaled by reference density - see CPC paper
 rlt   = 9,                        !Temperature gradient R/LT
 rln   = 3,                         !Density gradient R/Ln
 uprim = 0.3,                        !Gradient of the toroidal velocity R^2 grad omega / v_thref, toroidal shear flow
 / 
 &SPECIES 
 MASS  = 2.7777e-4,                 !Yes, these are the electrons
 Z     = -1.0,                         !Only one species may have negative charge. No muons or antiprotons please.
 TEMP  = 1.0, 
 dens  = 1.0,
 rlt   = 9,
 rln   = 3., 
 uprim = 0.3,
 /
!---------------------------------------------------------------------------------------------------------------------
 &ROTATION                        !Optional Namelist read in rotation.F90
 VCOR = 0.2                        !Rotation of the plasma vcor =  Rref Omega / vthref = \Omega_N        (default = 0.0)
 coriolis = .true.              !Keep the coriolis term                                        (default = T)
 cf_trap=.true.
 cf_upphi=.true.
 cf_upsrc=.true.
 cf_drift=.true.
/ 
!---------------------------------------------------------------------------------------------------------------------
&DIAGNOSTIC
 NFLUSH_TS = 2
 LFLUXES_SPECTRA=.false.
 LFLUXES_DETAIL=.false.
 LPARALLEL_PHI=.false.
 LMPI_BROKEN_IO=.true.
 LWRITE_OUTPUT1  = .true.
 LCALC_FLUXES    = .true.
 LCALC_FREQ      = .true. 
 LFINAL_OUTPUT   = .false.
 LPHI_DIAGNOSTICS = .false.
/
!
