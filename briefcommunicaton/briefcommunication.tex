% AUTHOR ===================================================================================================================
% Manuel Lippert (GitHub: ManeLippert (https://github.com/ManeLippert))
% ==========================================================================================================================

% PREAMBLE =================================================================================================================

% ****** Start of file aipsamp.tex ******
%
%   This file is part of the AIP files in the AIP distribution for REVTeX 4.
%   Version 4.1 of REVTeX, October 2009
%
%   Copyright (c) 2009 American Institute of Physics.
%
%   See the AIP README file for restrictions and more information.
%
% TeX'ing this file requires that you have AMS-LaTeX 2.0 installed
% as well as the rest of the prerequisites for REVTeX 4.1
% 
% It also requires running BibTeX. The commands are as follows:
%
%  1)  latex  aipsamp
%  2)  bibtex aipsamp
%  3)  latex  aipsamp
%  4)  latex  aipsamp
%
% Use this file as a source of example code for your aip document.
% Use the file aiptemplate.tex as a template for your document.

% DOCUMENT =================================================================================================================

\documentclass[aip, amsmath, amssymb, reprint, twocolumn]{revtex4-1}

% documentclass revtex4-1 options:
% - aip,
% - jmp,
% - bmf,
% - sd,
% - rsi,
% - amsmath,amssymb,
% - preprint,%
% - reprint,%
% - author-year,%
% - author-numerical,%
% - Conference Proceedings

\preprint{AIP/123-QED}

% PACKAGES =================================================================================================================

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{mathptmx}
\usepackage{etoolbox}
\usepackage{graphicx}% Include figure files
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
%\usepackage[mathlines]{lineno}% Enable numbering of text and display math
%\linenumbers\relax % Commence numbering lines

%% Additional
\usepackage{caption}
\usepackage{hyperref}

% FUNCTIONS, INPUT =========================================================================================================

\input{wordcount.tex}% Word & page count for document

\graphicspath{{../pictures/}}% Path for pictures

%% Apr 2021: AIP requests that the corresponding 
%% email to be moved after the affiliations
\makeatletter
\def\@email#1#2{
	\endgroup
	\patchcmd{\titleblock@produce}
		{\frontmatter@RRAPformat}
		{\frontmatter@RRAPformat{\produce@RRAP{*#1\href{mailto:#2}{#2}}}\frontmatter@RRAPformat}
		{}{}
}
\makeatother

%% Include graphic for one column with specific place 
\newcommand{\includegraphicsOneCol}[3]{
	\begin{figure}[ht]
		\includegraphics[width=0.90\linewidth]{#1}
		\caption{#2}
		\label{#3}
  	\end{figure}
  	\increasecounter{fig}{1}
}

%% Include graphic for two column with specific place, figrue* places graphic anywhere...
\newcommand{\includegraphicsTwoCol}[4]{
	\onecolumngrid
	\begin{center}
		\captionsetup{type=figure}
    	\includegraphics[width=#4\textwidth]{#1}
		\captionof{figure}{#2}
    	\label{#3}
	\end{center}
	\twocolumngrid
	\increasecounter{fig}{2}
}

%\newcommand{\includegraphicsTwoCol}[3]{
%	\begin{figure*}
%    	\includegraphics[width=0.9\textwidth]{#1}
%		\caption{#2}
%		\label{#3}
%	\end{figure*}
%	\increasecounter{fig}{2}
%}

\newcommand{\words}{
	\immediate\write18{texcount -sum -1 \jobname.tex > wordcount.txt}
}


\newcommand{\wexb}{\omega_{\mathrm{\:E \times B}}}
\newcommand{\exb}{\mathrm{\:E \times B}}
\newcommand{\hatwexbkvec}{\widehat{\omega}_{\mathrm{\:E \times B},\mathbf{k}}}
\newcommand{\NR}{N_\mathrm{R}}
\newcommand{\NB}{N_\mathrm{B}}
\newcommand{\vthref}{v_\mathrm{th,ref}}
\newcommand{\Rref}{R_\mathrm{ref}}
\newcommand{\rlt}{R/L_T}
\newcommand{\rhothref}{\rho_\mathrm{th,ref}}

% MAIN =====================================================================================================================

\begin{document}

%% TITLE, INFO =============================================================================================================

\title[Wavelength convergence of the ${\mathrm{\:E}\times\mathrm{B}}$ staircase pattern in flux tube simulations of ion temperature gradient driven turbulence]
{Wavelength convergence of the ${\mathrm{\:E}\times\mathrm{B}}$ staircase pattern in flux tube simulations of ion temperature gradient driven turbulence}

\author{M. Lippert}
	\altaffiliation{Repository of this work: \\ 
					https://github.com/ManeLippert/Bachelorthesis-Shearingrate-Wavelength}
\author{F. Rath}
	\altaffiliation{Author to whom correspondence should be addressed: \\
					Florian.Rath1@uni-bayreuth.de}
	\email{Florian.Rath1@uni-bayreuth.de}
\author{A. G. Peeters}
\affiliation{Physics Department, University of Bayreuth, 95440 Bayreuth, Germany}

\date{\today}

%% ABSTRACT ================================================================================================================

\begin{abstract}
    The wavelength convergence of the $\exb$ staircase pattern is adressed in local gradient-driven flux tube simulations of ion temperature gradient (ITG) driven turbulence.
    Its is shown that a mesoscale pattern wavelength of $\sim 57.20 - 76.27~\rhothref$ is inherent to ITG driven turbulence with Cyclone Base Case paramters in the local limit. 
    
\end{abstract}

\maketitle

%% TEXT ====================================================================================================================

%%% INTRODUCTION ===========================================================================================================

%\section{Introduction}
%\label{sec:intro}

Ion temperature gradient driven turbulence close to marginal stability often exhibits zonal flow pattern formation on mesoscales \textemdash so-called ${\mathrm{\:E}\times\mathrm{B}}$ staircase structures \cite{pradalier2010}.
Such pattern formation has been observed in local gradient-driven flux-tube simulations \cite{peeters2016, weikl2017, rath2021} as well as global gradient-driven \cite{mcmillan2009, villard2013, seo2022} and global flux-driven \cite{pradalier2010, pradalier2015, wang2020, kim2022, kishimoto2023} studies. 
In global studies, usually spanning a larger fraction of the minor radius, multiple radial repetitions of staircase structures are usually observed, with a typical pattern wavelength of several ten Larmor radii.
% By contrast, the radial domain size of local flux-tube simulations is often restricted to a similar mesoscale.
By contrast, in the aformentioned local studies the wavelength of ${\mathrm{\:E}\times\mathrm{B}}$ staircase structures is always found to converge to the radial box size of the flux tube domain.
The above observations lead to the question: 
Does the basic pattern wavelength always converges to the box size, or is there a typical mesoscale wavelength inherent to staircase structures also in a local flux-tube description?
The latter case would imply that it is not necessarily global physics, i.e., profile effects, that sets (i) the wavelength of the ExB staircase pattern and (ii) the scale of avalanche-like transport events, usually restricted to ${\mathrm{\:E}\times\mathrm{B}}$ staircase structures and considered as a nonlocal transport mechnaism\cite{pradalier2010}. 
In this brief communication the above question is addressed through a box size convergence scan of the same cases close to the nonlinear threshold for turbulence generation as studied in Ref.~\cite{peeters2016}.\bigskip

%%% SIMULATION SET-UP ======================================================================================================

\begin{table}[ht]
	\begin{ruledtabular}
		\begin{tabular}{l | ccccc | ccccc | c | cc}
			& $N_m$ & $N_x$ & $N_s$ & $N_{\nu_\parallel}$ & $N_\mu$ & $D$ & $\nu_d$           & $D_{\nu_\parallel}$ & $D_x$ & $D_y$ & Order & $k_y\rho$ & $k_x\rho$ \\
			\hline
			S6   & 21    & 83    & 16    & 48                  & 9       & 1   & $|\nu_\parallel|$ & 0.2                 & 0.1   & 0.1   & 6     & 1.4       & 2.1       \\
		\end{tabular}
	\end{ruledtabular}
	\caption{
		Resolution used in this paper for further information read Ref.~\cite{peeters2016}. %: Number of toroidal modes $N_m$, number of radial modes $N_x$, number of grid points along the magnetic field $N_s$,number of parallel velocity grid points $N_{\nu_\parallel}$, number of magnetic moment grid points $N_\mu$, dissipation coefficient used in convection along the magnetic field $D$,the velocity in the dissipation scheme $\nu_d$, dissipation coefficient used in the trapping term $D_{\nu_\parallel}$, damping coefficient of radial modes $D_x$, damping coefficient of toroidal modes $D_y$, order of the scheme used for the zonal mode, maximum poloidal wave vector $k_y\rho$, and maximum radial wave vector $k_x\rho$
	}
	\label{tab:resolution}
\end{table}

Here, gyrokinetic simulations are performed with the non-linear flux tube version of Gyrokinetic Workshop (GKW) \cite{peeters2009} in the adiabatic electron approximation.
In agreement with Ref.~\cite{peeters2016}, Cyclone Base Case (CBC) like parameters are chosen with an inverse background temperature gradient length $R/L_T = 6.0$ (unless stated otherwise) and circular concentric flux surfaces. 
The numerical resolution is compliant to the "Standard resolution with 6th order (S6)" set-up of the aforementioned reference, with a somewhat lowered number of parallel velocity grid points.
It has been carefully verified that this modification preserves the same physical outcome as the orginial study.
A summary of the numerical parameters is given in Tab.~\ref{tab:resolution} and for more details about the definition of individual quantities the reader is referred to Refs.~\cite{peeters2009, peeters2016}. \\
The increase of the box size, relative to the standard box size $(l_\psi,~l_\zeta) = (76.27,~89.76)~\rho_\mathrm{th,ref}$, in the radial and binormal direction is always indicated by the real parametes $N_\mathrm{R}$ and $N_\mathrm{B}$, respectively.
Here, $\rho_\mathrm{th,ref}$ is the reference thermal Larmor radius and the nomenclature $N_\mathrm{R}\times N_\mathrm{B}$ is applied throughout this work to indicate the increase in box size.  
Note that the number of modes in the respective direction is always adapted accordingly to retain a spatial resolution compliant to the standard resolution (Tab.~\ref{tab:resolution}) and standard box size. \bigskip
  
%%% DIAGNOSTICS ================================================================================================================
The ${\mathrm{\:E}\times\mathrm{B}}$ staircase pattern is manifest as radial structure formation in the ${\mathrm{\:E}\times\mathrm{B}}$ shearing rate defined by\cite{rath2016, doi:10.1063/1.3005380, rath2016, peeters2016}
\begin{equation}
	\omega_{\mathrm{\:E \times B}} = \frac{1}{2} \frac{\partial^2 \langle \Phi \rangle}{\partial \psi^2},
	\label{eq:shearingrate}
\end{equation}
\increasecounter{eq}{1}{1}
where $\langle \Phi \rangle$ is the zonal electrostatic potential normalized by $\rho_\ast T_\mathrm{ref}/e$ ($\rho_\ast = \rho_\mathrm{th,ref}/R_\mathrm{ref}$ is the reference thermal Larmor radius normalized with the reference major radius $R_\mathrm{ref}$, $T_\mathrm{ref}$ is a reference temperature, $e$ is the elementary charge) and $\psi$ is the radial coordinate that labels the flux surfaces normalized by $\rho_\mathrm{th,ref}$.
The E$\times$B shearing rate $\omega_{\mathrm{\:E \times B}}$ is the radial derivative of the advecting zonal flow velocity \cite{doi:10.1063/1.871313, doi:10.1063/1.872847} and quantifies the zonal flow induced shearing of turbulent structures \cite{doi:10.1063/1.859529, doi:10.1063/1.871313, doi:10.1063/1.872367}. 
Here, the zonal potential is estimated from the electrostatic potential $\phi$ on the two dimensional $\psi$-$\zeta$-plane at the low field side according to
\begin{equation}
\langle \Phi \rangle = \frac{1}{l_\zeta} \int_0^{l_\zeta} \mathrm{d}\zeta ~ \phi(\psi,\zeta,s=0).
\end{equation}
In order to diagnose the temporal evolution of the staircase pattern and to obtain an estimate of its amplitude the radial Fourier transform of the ${\mathrm{\:E}\times\mathrm{B}}$ shearing rate is considered. 
It is defined by
\begin{equation}
	\omega_{\mathrm{\:E \times B}} = \sum_{k_j} \widehat \omega_{\mathrm{\:E \times B}}(k_j,t) \times \exp(\mathrm{i} k_j \psi),
	\label{eq:shearingrate_fourier}
\end{equation}
\increasecounter{eq}{1}{1}
were $\widehat \omega_{\mathrm{\:E \times B}}$ is the complex Fourier coefficient and 
% use j as zonal flow mode number to distinguish it from the imaginary unit i
\begin{equation}
	k_\mathrm{j} = \frac{2\pi \mathrm{j}}{l_\psi}
\end{equation}
\increasecounter{eq}{1}{1}
% explicitly introduce the terms zonal flow wave vector and zonal flow mode number for later usage
defines the zonal flow wave vector with the zonal flow mode number $j$ ranging in $-(N_\psi -1)/2 \leq j \leq (N_\psi -1)/2 $.
% define the zonal flow modes' amplitude in terms of the shearing rate
Based on the defintions above, the shear carried by the zonal flow mode with wave vector $k_j$ is defined by $|\widehat{\omega}_{\mathrm{\:E\times B}}|_{k_\mathrm{j}} = 2 |\widehat \omega_{\mathrm{\:E \times B}}|$. 
% introduces the term basic mode of the pattern for later usage
In general, the zonal flow mode that dominates the ${\mathrm{\:E}\times\mathrm{B}}$ staircase pattern, \textemdash also referred to as the \textit{basic mode } of the pattern in this work \textemdash exhibits the maximum amplitude in the spectrum $|\widehat{\omega}_{\mathrm{\:E\times B}}|_{k_\mathrm{j}}$.  
Consistent with Ref.~\cite{peeters2016} the turbulence level is quantified by the turbulent heat conduction coefficient $\chi$, which is normalized by $\rho_\mathrm{th,ref}^2 v_{\mathrm{th,ref}}/R_\mathrm{ref}$ ($v_{\mathrm{th,ref}} = \sqrt{2 T_\mathrm{ref}/m_\mathrm{ref}}$ is the reference thermal velocity and $m_\mathrm{ref}$ is the reference mass) throughout this work. \bigskip


%%% RESULTS ================================================================================================================

%\section{Results}
%\label{sec:results}

\includegraphicsTwoCol{{Comparison/Boxsize/S6_rlt6.0_boxsize1-2-3-4x1_Ns16_Nvpar48_Nmu9_comparison}.pdf}{
	\textbf{(a)} Time traces of the heat conduction coefficient $\chi$ for $R/L_T = 6.0$ for radial increased box sizes
	\textbf{(b)} Time traces of $|\widehat{\omega}_{\mathrm{\:E\times B}}|_{k_\mathrm{i}}$ for radial increased box sizes
}{fig:wexb-eflux-1-2-3-4x1-comparison}{}

\includegraphicsTwoCol{{Comparison/Boxsize/S6_rlt6.0_boxsize1-2-3-4x1_Ns16_Nvpar48_Nmu9_wexb_comparison}.pdf}{
	Comparison of shearing rate $\omega_{\mathrm{\:E \times B}}$ for radial increased box sizes. The staircase structure got 
	shifted for better visibility.
}{fig:wexb-1-2-3-4x1-stable-comparison}{}

% what kind of analysis
In the first test the radial box size is increased while the binormal box size is kept fixed to the standard size.
The scan covers the realizations $\NR\times\NB \in [ 1\times1,~2\times1,~3\times1,~4\times1]$.
% short introduction of the turbulence - zonal flow dynamics; cite peeters2016 explicitly to avoid any discussions lateron
Each realization exhibits an initial quasi-stationary turbulent phase and a second final \cite{peeters2016} phase with almost supressed turbulence (see Fig.~\ref{fig:wexb-eflux-1-2-3-4x1-comparison}).
% introduce the fully developed staircase structure
The latter state is indicative for the presence of a fully developed staircase pattern as depicted in Fig.~\ref{fig:wexb-1-2-3-4x1-stable-comparison}. 
This type of structure is characterized by intervals of almost constant shear with alternating sign satisfying the Waltz criterion $|\wexb| \approx \gamma$\cite{doi:10.1063/1.870934, doi:10.1063/1.872847} ($\gamma$ is the growth rate of the most unstable liner ITG driven Eigenmode), connected by steep flanks where $\wexb$ crosses zero.
% insofar the results of peeters2016 are well reproduced; now turn to the description of the main result of this test
Fig.~\ref{fig:wexb-1-2-3-4x1-stable-comparison} shows a striking repetition of the staircase structure, with the number of repetitions equal to $\NR$.
% yes, the wavelength converges; but even stronger result: the standard box size already allows for the correct staircase wavelength
Hence, the basic wavelength of the pattern not only converges with increasing radial box size, the converged wavelength turns out to agree with the standard radial box size of Ref.~\cite{peeters2016} \\
% cautios words
Due to the lack of a substantial turbulent drive in the final suppressed state no further zonal flow evolution is observed [panel (b) of Fig.~\ref{fig:wexb-eflux-1-2-3-4x1-comparison}] and one might critically ask whether the structures shown in Fig.~\ref{fig:wexb-1-2-3-4x1-stable-comparison} represent the real converged pattern in a statistical sense. 
% very long initial quasi-stationary states
Note that in the $3 \times 1$ case the initial quasi-stationary turbulent state extends up to a few $\sim 10^4~\Rref/\vthref$.
% the j=3 zonal flow mode does show a temporal evolution with a few cycles covered by the initial turbulent phase -> this allows for some degree of statistical argument
During this period the zonal flow mode with $j = 3$, i.~e., the mode that dominates the staircase pattern in final suppressed phase, undergoes a long-term evolution with a typical time scale of several $\sim 10^3~\Rref/\vthref$. 
Hence, several of such cycles are covered by the initial turbulent phase, which is evident from the occurrence of phases with reduced amplitude around $t \approx 8000~\Rref/\vthref$ and $t \approx 18000~\Rref/\vthref$.
% first important point: competition between the j = 3 and j = 4 mode -> the j = 4 mode is of shorter length scale compared to the j = 3 mode, hence, no convergence to the box scale
It is the $j = 4$ zonal flow mode, i.~e., the next shorter radial scale mode, that domiantes the shear spectrum $|\hatwexbkvec|$ in the latter two phases (not shown), demonstrating a competition between the $j = 3$ and $j = 4$ modes.
% second important point: no secular growth of the box scale zonal mode
Most importantly, no secular growth of the $j = 1$ (box scale) zonal flow mode is observed during the entire quasi-stationary turbulent phase [dotted line in panel (b) of Fig.~\ref{fig:wexb-eflux-1-2-3-4x1-comparison}]].
% summary
The above discussion indicates that although the $j = 3,~4$ zonal modes compete, the pattern scale does not converge to the radial box scale but rather to a mesoscale of $\sim 57.20 - 76.27~\rhothref$ (i.~e., $j = 4,~3$ in the $3\times1$ case). \\

% what kind of analysis
Since the radially elongated simulation domain might inhibit the development of isotropic turbulent structures, in the second test the radial and binormal box size is increased simulataneously.
This scan covers the realizations $\NR\times\NB \in [1\times1,~2\times2,~3\times3]$.
% mention shorter times scales for stabilization
Interestingly, here, suppression of the turbulence by the emergence of a fully developed staircase pattern occurs after $\sim 1000~\Rref/\vthref$ always (see Fig. \ref{fig:eflux-1x1-2x2-3x3-comparison}), i.~e., significantly faster compared to the $3\times1$ and $4\times1$ realizations. 
% Although the computational costs per time step is higher, the difference in the time scales renders this test computationally cheaper.
%
% the main result of this test: confirmation of wave length convergence
As shown in Fig.~\ref{fig:wexb-3x3-stable} also this test confirms the convergence of the staircase pattern wavelength to a typical mesoscale that is distinct from the radial box size in the $\NR > 1$ realizations. 
% discuss sumewhat smaller wavelength
By contrast to the radial box size scan, however, here the $3\times3$ realization shows a stationary pattern with four repetitions of the fully developed staircase structure, i.~e., a somewhat smaller pattern wavelength. 
Whether this is related to a possible pattern wavelength dependence on the binormal box size or to the competition between patterns with the two wavelengths $\lambda \in [57.20,~ 76.27]~\rhothref$ as observed in the first test is adressed in the next paragraph. \bigskip

% what kind of analysis
In a third test the binormal box size is varied with the radial box size fixed to $\NR = 3$.
This test covers the realizations $\NR \times \NB \in [3\times1.5,~3\times2.5,~3\times3,~3\times5]$.
% -> outcome?
\bigskip

% what kind of test
In the final test the inverse background temperature gradient length $\rlt$ is varied at fixed $3\times3$ box size.
Since suppression of turbulence usually occurs at later times when approaching the finite heat flux treshold from below \cite{peeters2016}, the analysis aims to lengthen the phase during which the zonal flow varies in time due to turbulent Reynolds stresses.
This scan covers realizations with $\rlt \in [6.0,~6.2,~6.4]$.
% what is the finite heat flux threshold
In the case of $\rlt = ???$ turbulence suppression is observed for $t > ???$, while stationary turbulence during the entire simulation time trace of $???~\Rref/\vthref$ is found for $\rlt = ???$.
The finite heat flux threshold, hence, is $\rlt|_\mathrm{finite} = ??? \pm ???$.
% Which stationay wavelength occurs????
Although the initial quasi-stationary turbulence in the former case is significantly larger compared to the $\rlt = 6.0$ realization discussed in the second test, a stationary pattern with basic zonal flow mode $j = ???$ establishes. 
% Does it confirm our previous tests
Again, the $j = 1$ (box scale) zonal flow mode does not grow secularly during the entire turbulent phase.
Also this test confirmes the statistical soundness of the converged pattern wavelength of $\sim ???$.

\includegraphicsOneCol{{Comparison/Boxsize/S6_rlt6.0_boxsize1x1-2x2-3x3_Ns16_Nvpar48_Nmu9_eflux_comparison}.pdf}{
	Time traces of the heat conduction coefficient $\chi$ for $R/L_T = 6.0$ for radial and binormal increased box sizes
}{fig:eflux-1x1-2x2-3x3-comparison}

%\includegraphicsOneCol{{S6_rlt6.0/boxsize3x3/Ns16/Nvpar48/Nmu9/S6_rlt6.0_boxsize3x3_Ns16_Nvpar48_Nmu9_wexb_selection}.pdf}{
%	Stablized shearing rate $\omega_{\mathrm{\:E \times B}}$ for boxsize 3$\times$3. \textcolor{red}{Add $1\times1$, $2\times2$!}
%}{fig:wexb-3x3-stable} 


%%% CONCLUSION =============================================================================================================

%\section{Conclusion}
%\label{sec:conclusion}

\bigskip
\bigskip
\bigskip
\bigskip
\bigskip
\bigskip

% what has been done
Through careful tests this briefcommunication confirms the wavelength convergence of the $\exb$ staircase pattern in local gyrokinetic flux tube simulations of ion temperature gradient (ITG) driven turbulence.
% mention the scale explicitly, and also that it is the scale compliant to CBC parameters (for other plasma parameters it might differ)
A mesoscale pattern wavelength of $\sim 57.20 - 76.27~\rhothref$ is found to be intrinsic to ITG driven turbulence for Cyclone Base Case parameters.
% compare to other studies
This length scale is somewhat larger compared to results from global studies with finite $\rho_\ast$, which report of a few $10^1~\rhothref$ \cite{pradalier2010}, and has to be considered the proper mesoscale in the local limit $\rho_\ast \rightarrow 0$.  
% relevance of the outcome
The occurrence of this mesoscale implies that non-locality is inherent to ITG driven turbulence, since avalanches are usually spatially organized by the $\exb$ staircase pattern \cite{mcmillan2009, pradalier2010, rath2016, peeters2016}. 


%% APPENDIX ================================================================================================================

\section*{Data Availability}
The data that support the findings of this study are available from the corresponding author upon reasonable request. 
\bigskip
\bigskip
\bigskip
\bigskip
\bigskip
\bigskip

% WORDCOUNT ================================================================================================================

\wordcountmessage

% BIBLIOGRAPHY =============================================================================================================

\nocite{}
\bibliography{references.bib}% Produces the bibliography via BibTeX.

\end{document}
% END MAIN =================================================================================================================
% ****** End of file aipsamp.tex ******
